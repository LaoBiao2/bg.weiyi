<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Index</title>
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/index.css">
    <script src="./js/jquery-1.9.1.min.js"></script>
</head>

<body>
    <div id="nav"></div>
    <div class="container">
        <div class="box basic">
            <div class="top-box">
                <b>基本资料</b>
                <span><i></i>我们承诺对阁下的个人信息严格保密</span>
            </div>
            <div class="content-box">
                <div class="item name">
                    <p>真实姓名</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item idNum">
                    <p>身份证号</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item select-box callName">
                    <p>称呼</p>
                    <select name="call" onchange="changeSelect(this, this.value)">
                        <option value="-1">请选择</option>
                        <option value="女士">女士</option>
                        <option value="先生">先生</option>
                    </select>
                    <span></span>
                </div>
                <div class="item addr">
                    <p>联系地址</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item phone">
                    <p>电话号码</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item email">
                    <p>邮箱地址</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item idcard-box idPhoto">
                    <p>身份证照片</p>
                    <div class="idcard clearfix">
                        <div class="card-item front">
                            <input type="file" id="cardFront" name="idcard_front" onchange="xmTanUploadImg(this)"
                                accept="image/*">
                            <div class="file">
                                <img src="" alt="" id="cardFront-img">
                            </div>
                            <b>请上传身份证正面照片</b>
                        </div>
                        <div class="card-item back">
                            <input type="file" id="cardBack" name="idcard_back" onchange="xmTanUploadImg(this)" accept="image/*">
                            <div class="file">
                                <img src="" alt="" id="cardBack-img">
                            </div>
                            <b>请上传身份证反面照片</b>
                        </div>
                    </div>
                </div>
                <a href="javascript:;" class="submit-a" onclick="checkAll(this)">提交资料</a>
            </div>
        </div>
        <div class="box brank">
            <div class="top-box">
                <b>银行资料</b>
                <span><i></i>个人资料与银行资料必须一致，否则影响您的正常取款，需修改资料请联系客服</span>
            </div>
            <div class="content-box">
                <div class="item name">
                    <p>真实姓名</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item select-box brankName">
                    <p>银行名称</p>
                    <select name="bank" onchange="changeSelect(this, this.value)">
                        <option value="-1">请选择银行</option>
                        <option value="中国银行">中国银行</option>
                        <option value="建设银行">建设银行</option>
                        <option value="农业银行">农业银行</option>
                        <option value="工商银行">工商银行</option>
                        <option value="交通银行">交通银行</option>
                        <option value="中信银行">中信银行</option>
                        <option value="华夏银行">华夏银行</option>
                        <option value="招商银行">招商银行</option>
                        <option value="兴业银行">兴业银行</option>
                        <option value="广发银行">广发银行</option>
                        <option value="浦发银行">浦发银行</option>
                        <option value="光大银行">光大银行</option>
                        <option value="0">其他银行</option>
                        <option value="1">填写</option>
                    </select>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item brankNum">
                    <p>银行账号</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item brankDet">
                    <p>银行支行</p>
                    <input type="text" name="" id="">
                    <span></span>
                </div>
                <div class="item idcard-box brankPhoto">
                    <p>银行卡照片</p>
                    <div class="idcard clearfix">
                        <div class="card-item front">
                            <input type="file" id="cardFront" name="idcard_front" onchange="xmTanUploadImg(this)"
                                accept="image/*">
                            <div class="file">
                                <img src="" alt="" id="cardFront-img">
                            </div>
                            <b>点击上传银行卡正面</b>
                        </div>
                        <div class="card-item back">
                            <input type="file" id="cardBack" name="idcard_back" onchange="xmTanUploadImg(this)" accept="image/*">
                            <div class="file">
                                <img src="" alt="" id="cardBack-img">
                            </div>
                            <b>点击上传银行卡反面</b>
                        </div>
                    </div>
                </div>
                <a href="javascript:;" class="submit-a" onclick="checkAll(this)">提交资料</a>
            </div>
        </div>
    </div>
    <script>
        $("#nav").load("./common/nav.html")
        $(function () {
            //判断浏览器是否支持FileReader接口
            if (typeof FileReader == 'undefined') {
                console.log("<h1>当前浏览器不支持FileReader接口</h1>");
                //使选择控件不可操作
                $("#cardFront-img").setAttribute("disabled", "disabled");
                $("#cardBack-img").setAttribute("disabled", "disabled");
            }
        })

        function xmTanUploadImg(obj) {
            var file = obj.files[0];

            // console.log(obj);console.log(file);
            // console.log("file.size = " + file.size);  //file.size 单位为byte

            var reader = new FileReader();

            //读取文件过程方法
            reader.onloadstart = function (e) {
                console.log("开始读取....");
            }
            reader.onprogress = function (e) {
                console.log("正在读取中....");
            }
            reader.onabort = function (e) {
                console.log("中断读取....");
            }
            reader.onerror = function (e) {
                console.log("读取异常....");
            }
            reader.onload = function (e) {
                console.log("成功读取....");

                // var img = $("#cardFront-img");
                $(obj).siblings().find("img").attr("src", e.target.result);
                //或者 img.src = this.result;  //e.target == this
            }
            reader.readAsDataURL(file)
        }
        $(".card-item b").click(function () {
            $(this).siblings().eq(0).trigger("click");
            if ($(this).find(".file img").attr("src") != '') {
                $(this).fadeOut();
            }
        })
        $(".card-item .file").click(function () {
            $(this).siblings().eq(0).trigger("click");
        })

        // 表单判断
        // 姓名判断
        $(".item.name input").on('blur input propertychange', function () {
            var re = /^[\u4E00-\u9FA5]+$/;
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("真实姓名不能为空");
                return false;
            } else if (!re.test($(this).val())) {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("真实姓名不正确");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        // 身份证号判断
        $(".item.idNum input").on('blur input propertychange', function () {
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("身份证号不能为空");
                return false;
            } else if (!checkCard($(this).val())) {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("身份证号不正确");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })
        var vcity = {
            11: "北京",
            12: "天津",
            13: "河北",
            14: "山西",
            15: "内蒙古",
            21: "辽宁",
            22: "吉林",
            23: "黑龙江",
            31: "上海",
            32: "江苏",
            33: "浙江",
            34: "安徽",
            35: "福建",
            36: "江西",
            37: "山东",
            41: "河南",
            42: "湖北",
            43: "湖南",
            44: "广东",
            45: "广西",
            46: "海南",
            50: "重庆",
            51: "四川",
            52: "贵州",
            53: "云南",
            54: "西藏",
            61: "陕西",
            62: "甘肃",
            63: "青海",
            64: "宁夏",
            65: "新疆",
            71: "台湾",
            81: "香港",
            82: "澳门",
            91: "国外"
        };
        checkCard = function (obj) {
            //校验长度，类型 
            if (isCardNo(obj) === false) {
                return false;
            }
            //检查省份 
            if (checkProvince(obj) === false) {
                return false;
            }
            //校验生日 
            if (checkBirthday(obj) === false) {
                return false;
            }
            //检验位的检测 
            if (checkParity(obj) === false) {
                return false;
            }
            return true;
        };
        //检查号码是否符合规范，包括长度，类型 
        isCardNo = function (obj) {
            //身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X 
            var reg = /(^\d{15}$)|(^\d{17}(\d|X)$)/;
            if (reg.test(obj) === false) {
                return false;
            }
            return true;
        };
        //取身份证前两位,校验省份 
        checkProvince = function (obj) {
            var province = obj.substr(0, 2);
            if (vcity[province] == undefined) {
                return false;
            }
            return true;
        };
        //检查生日是否正确 
        checkBirthday = function (obj) {
            var len = obj.length;
            //身份证15位时，次序为省（3位）市（3位）年（2位）月（2位）日（2位）校验位（3位），皆为数字 
            if (len == '15') {
                var re_fifteen = /^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;
                var arr_data = obj.match(re_fifteen);
                var year = arr_data[2];
                var month = arr_data[3];
                var day = arr_data[4];
                var birthday = new Date('19' + year + '/' + month + '/' + day);
                return verifyBirthday('19' + year, month, day, birthday);
            }
            //身份证18位时，次序为省（3位）市（3位）年（4位）月（2位）日（2位）校验位（4位），校验位末尾可能为X 
            if (len == '18') {
                var re_eighteen = /^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;
                var arr_data = obj.match(re_eighteen);
                var year = arr_data[2];
                var month = arr_data[3];
                var day = arr_data[4];
                var birthday = new Date(year + '/' + month + '/' + day);
                return verifyBirthday(year, month, day, birthday);
            }
            return false;
        };
        //校验日期 
        verifyBirthday = function (year, month, day, birthday) {
            var now = new Date();
            var now_year = now.getFullYear();
            //年月日是否合理 
            if (birthday.getFullYear() == year && (birthday.getMonth() + 1) == month && birthday.getDate() == day) {
                //判断年份的范围（3岁到100岁之间) 
                var time = now_year - year;
                if (time >= 0 && time <= 130) {
                    return true;
                }
                return false;
            }
            return false;
        };
        //校验位的检测 
        checkParity = function (obj) {
            //15位转18位 
            obj = changeFivteenToEighteen(obj);
            var len = obj.length;
            if (len == '18') {
                var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
                var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
                var cardTemp = 0,
                    i, valnum;
                for (i = 0; i < 17; i++) {
                    cardTemp += obj.substr(i, 1) * arrInt[i];
                }
                valnum = arrCh[cardTemp % 11];
                if (valnum == obj.substr(17, 1)) {
                    return true;
                }
                return false;
            }
            return false;
        };
        //15位转18位身份证号 
        changeFivteenToEighteen = function (obj) {
            if (obj.length == '15') {
                var arrInt = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2);
                var arrCh = new Array('1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2');
                var cardTemp = 0,
                    i;
                obj = obj.substr(0, 6) + '19' + obj.substr(6, obj.length - 6);
                for (i = 0; i < 17; i++) {
                    cardTemp += obj.substr(i, 1) * arrInt[i];
                }
                obj += arrCh[cardTemp % 11];
                return obj;
            }
            return obj;
        };

        // 地址判断
        $(".item.addr input").on('blur input propertychange', function () {
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("地址不能为空");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })
        
        // 邮箱判断
        $(".item.email input").on('blur input propertychange', function () {
            var re = /^[a-zA-Z0-9_-]+@([a-zA-Z0-9]+\.)+(com|cn|net|org)$/;
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("邮箱不能为空");
                return false;
            } else if (!re.test($(this).val())) {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("邮箱不正确");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        // 电话判断
        $(".item.phone input").on('blur input propertychange', function () {
            var re = /^[1][3,4,5,7,8][0-9]{9}$/;
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("电话号码不能为空");
                return false;
            } else if (!re.test($(this).val())) {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("电话号码不正确");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        // 银行名称判断
        $(".item.brankName input").on('blur input propertychange', function () {
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("银行名称不能为空");
                $(this).fadeOut();
                $(".item.brankName select").val('-1');
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        // 银行账号判断
        $(".item.brankNum input").on('blur input propertychange', function () {
            var re = /^([1-9]{1})(\d{14}|\d{18})$/;
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("银行账号不能为空");
                return false;
            } else if (!re.test($(this).val().replace(/\s+/g, ""))) {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("银行账号不正确");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        // 银行支行判断
        $(".item.brankDet input").on('blur input propertychange', function () {
            if ($(this).val() == '') {
                $(this).parent().addClass("warning").removeClass("success");
                $(this).parent().find("span").text("银行支行不能为空");
                return false;
            } else {
                $(this).parent().removeClass("warning").addClass("success");
                $(this).parent().find("span").text("");
                return true;
            }
        })

        function changeSelect(obj, i) {
            if (i == '1') {
                $(obj).next().fadeIn().focus();
            } else if (i != '-1') {
                $(obj).parent().addClass("success").removeClass("warning");
            } else {
                $(obj).parent().addClass("warning").removeClass("success");
            }
        }

        function checkAll(o) {
            $(o).parent().find(".item input").trigger("blur");
            $(o).parent().find(".select-box select").trigger("onchange");
            
            if($(o).parent().find(".item").hasClass("warning")) {
                alert("请确认表单信息");
                return false;
            } else if ($(o).siblings().find(".idcard .front .file img").attr("src") == '' || $(o).siblings().find(".idcard .back .file img").attr("src") == '') {
                alert("请上传照片");
            } else {
                alert("success");
            }
        }
    </script>
</body>

</html>